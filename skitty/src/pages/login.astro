---
import AstroLayout from "../layouts/AstroLayout.astro";
import ThemeIconSolid from "../components/ThemeIconSolid.astro";
---

<AstroLayout title={"Docs"} center={false}>
    <ThemeIconSolid />
    <div class="flex h-full">
        <h2>GrpcEmailLogin</h2>
        <form id="login-form">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required />
            <br /><br />
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required />
            <br /><br />
            <button type="submit">Login</button>
        </form>
    </div>
</AstroLayout>

<script>
    document
        .getElementById("login-form")
        .addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent default form submission

            const email = (document.getElementById("email") as HTMLInputElement)
                .value;
            const password = (
                document.getElementById("password") as HTMLInputElement
            ).value;

            fetch("http://localhost:7777/auth.v1.AuthService/EmailLogin", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                credentials: "include",
                body: JSON.stringify({ email, password }),
            })
                .then((response) => {
                    if (response.redirected) {
                        window.location.href = response.url;
                    }
                    return response.json();
                })
                .then((data) => {
                    // Handle the response, e.g., display a success message or redirect
                    console.log("Success:", data);
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
        });
</script>
